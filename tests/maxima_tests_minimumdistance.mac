/* 
  Experiments for the paper [1]
  [1] New paper (sending status)
 
  This Maxima code uses the functions geod_inverse and geod_direct
  to solve the inverse and direct geodesic problems from
  Charles karney  https://geographiclib.sourceforge.io/
  
  Go to the Maxima GeographicLib implementation and see the 
  instructions from the geodesic.mac file.
  
  To run this tests we have setup geodesic.mac with:
   Maxpow = 20, geod20.lsp, 
   and exact precision with 60 digits
*/

load("geodesic.mac")$

/*
--Maxima Function
geodesicMinimumDistanceError (name, laa, loa, lab, lob, lap, lop, lax, lox):=block(
  [dAB, aAB, dXP, aXP, dAX, aAX, aXA, lax1, lox1, lax2, lox2, lax3, lox3, dabx, dxpx, d1,d2,az1,az2,az3],
  print (" "),print ("Calculando para: ", name),

  s:geod_inverse(wgs84, laa, loa, lab, lob),
  dAB:s[2], aAB:s[3], 
  s:geod_inverse(wgs84, lax, lox, lap, lop),
  dXP:s[2], aXP:s[3], print ("d_xp(m): ", dXP),

  s:geod_inverse(wgs84, laa, loa, lax, lox),
  dAX:s[2], aAX:s[3], aXA:s[4],  
  s:geod_direct(wgs84, laa, loa, aAB, dAX),
  lax1:s[2],lox1:s[3],
  s:geod_inverse(wgs84, lax, lox, lax1, lox1),
  dabx:s[2], 
  print ("d_x'x''(m): ", dabx),

  s:geod_direct(wgs84, lax, lox, aXA + 90, dXP),
  lax2:s[2],lox2:s[3],
  s:geod_direct(wgs84, lax, lox, aXA - 90, dXP),
  lax3:s[2],lox3:s[3],
  s:geod_inverse(wgs84, lap, lop, lax2, lox2),
  d1:s[2], 
  s:geod_inverse(wgs84, lap, lop, lax3, lox3),
  d2:s[2], 
  dxpx:min (abs(d1),abs(d2)),
  print ("d_pp'(m): ", dxpx),
    
  maxdifdist: max (abs(dxpx), abs(dabx)), 
  print ("maxdifdist (m): ", maxdifdist),
  
  az1: aAB-aAX, print ("az1: ", az1),
  az2: 90 - abs(aXA - aXP), print ("az2: ", az2),
  s:geod_inverse(wgs84, lax, lox, lab, lob),
  aXB:s[3],  
  az3: 90 - abs(aXB - aXP), print ("az3: ", az3),

  maxdifaz: max (abs(az1), abs(az2), abs(az3)) * 3600,
  print ("maxdifaz (''): ", maxdifaz)
)$

/* Cases 1: XP= 23.7km, 2: XP= 1010km, 3: XP=3928km*/

/* With Java: Case 1 (3 iterations): 60000/s. Case 2 (4 iterations): 40000/s. Case 3 (4 iterations): 40000/s */
geodesicMinimumDistanceError ("Case 1 Paper JAVA", 52,5,51.4,6,52,5.5,51.84608922705115,5.260428494961068)$
geodesicMinimumDistanceError ("Case 2 Paper JAVA", 42,29,39,-77,64,-22, 54.92853149711693,  -21.93729106604878)$
geodesicMinimumDistanceError ("Case 3 Paper JAVA", 42,29,-35,-70,64,-22, 37.9781176779955, 18.349063315076897)$


geodesicMinimumDistanceError ("Case 4 Paper JAVA", 76.4, 56.3, 75.3, -129.4, 36, -36.7, 89.28146073143607, 147.17870590448175)$
geodesicMinimumDistanceError ("Case 5 Paper JAVA", 70,50,70,80,90,3,70.63042064855551,65.00000000000006)$
geodesicMinimumDistanceError ("Case 6 Paper JAVA", 70,50,-130,70,30,140,89.99999999999999,50.0)$
geodesicMinimumDistanceError ("Case 7 Paper JAVA", 40,-42,63,65.5,68.64690953749886,15.438098599510266,68.64690953749887,15.43809859951026)$

  

/* Results	
	"Calculando para: "" ""Case 1 Paper PG"" "
	"d_xp(m): "" "2.37677241837983386664058742448842471942065617527951139009736b4" "
	"d_x'x''(m): "" "1.88647299301342255061711539939656067761597561626849284790969b-9" "
	"d_pp'(m): "" "4.03000129057565945220197202265368600893860193802941545910421b-9" "
	"maxdifdist (m): "" "4.03000129057565945220197202265368600893860193802941545910421b-9" "
	"az1: "" "4.36111823890130523604168881754023049402716343103405920618893b-12" "
	"az2: "" "9.7149645940838039590384544827691364291424325212625848479117b-12" "
	"az3: "" "3.83841488088303685422386312886247339250997534751702913382222b-12" "
	"maxdifaz (''): "" "3.49738725387016942525384361379688911449127570765453054524821b-8" "
	" "" "
	"Calculando para: "" ""Case 2 Paper PG"" "
	"d_xp(m): "" "1.01058599883681830340506599143541559099538743854433890242743b6" "
	"d_x'x''(m): "" "1.94773910748664342481567191342504934385865333098891117076097b-9" "
	"d_pp'(m): "" "2.15582657824619336640453886163946089117239646370955689888625b-9" "
	"maxdifdist (m): "" "2.15582657824619336640453886163946089117239646370955689888625b-9" "
	"az1: "" "3.02815078194943734855223865187739202400304702185403557247387b-14" "
	"az2: "" "-1.22737134808324847245429383446515999117037772690321570174693b-13" "
	"az3: "" "-7.68727732971852784767427385034689750047033652375327781944871b-14" "
	"maxdifaz (''): "" "4.41853685309969450083545780407457596821335981685157652628895b-10" "
	" "" "
	"Calculando para: "" ""Case 3 Paper PG"" "
	"d_xp(m): "" "3.92842273531622203520198537909091280748101529195004187753923b6" "
	"d_x'x''(m): "" "2.73230147961475604901624575067978879738478619884422691685961b-10" "
	"d_pp'(m): "" "5.97528730404982752747677608040041777640256002441912979878169b-10" "
	"maxdifdist (m): "" "5.97528730404982752747677608040041777640256002441912979878169b-10" "
	"az1: "" "-1.5528965317043698745840807859273865842633637763309148852713b-14" "
	"az2: "" "9.29033520516610017233198562789729694864186050208205041643857b-15" "
	"az3: "" "-5.16887595186444764965361821343953453064365413064270018423465b-15" "
	"maxdifaz (''): "" "5.59042751413573154850269082933859170334810959479129358697666b-11" "

	"Calculando para: "" ""Case 1 Paper JAVA"" "
	"d_xp(m): "" "2.37677241838024170947443867735797122887327243784224743005666b4" "
	"d_x'x''(m): "" "2.19195534549916119750558380402869162918633715330271706537302b-9" "
	"d_pp'(m): "" "3.62372624603462958649618975971215026110356549290457105770595b-9" "
	"maxdifdist (m): "" "3.62372624603462958649618975971215026110356549290457105770595b-9" "
	"az1: "" "-5.06732747911867081969404655598411109181581439011823638156324b-12" "
	"az2: "" "-8.7355734255469396261669172140725186948272259982193003590765b-12" "
	"az3: "" "-1.90741600975240373227973454127789216543194888770074301643376b-12" "
	"maxdifaz (''): "" "3.14480643319689826542009019706610673013780135935894812926754b-8" "
	" "" "
	"Calculando para: "" ""Case 2 Paper JAVA"" "
	"d_xp(m): "" "1.01058599883681514361877299160575671483130163722037986361555b6" "
	"d_x'x''(m): "" "1.21204718551318480911424234304128352655739004722493343778354b-9" "
	"d_pp'(m): "" "9.22876369929484588220929548490920428126820722662341539394599b-11" "
	"maxdifdist (m): "" "1.21204718551318480911424234304128352655739004722493343778354b-9" "
	"az1: "" "-1.88437025188012002952962159761978181243092347328260834325992b-14" "
	"az2: "" "-5.25418893015046165757805142936373810428821304300099934736643b-15" "
	"az3: "" "-3.37948543977493670213633167729187889194416711817904364660492b-14" "
	"maxdifaz (''): "" "1.21661475831897721276907940382507640109990016254445571277777b-10" "
	" "" "
	"Calculando para: "" ""Case 3 Paper JAVA"" "
	"d_xp(m): "" "3.92842273531622188146429329602974938619506776139119339809279b6" "
	"d_x'x''(m): "" "4.26967840044536805148313235885058639809526916416520252015602b-10" "
	"d_pp'(m): "" "9.30676525994550022415658619508883161435102641781977503710486b-10" "
	"maxdifdist (m): "" "9.30676525994550022415658619508883161435102641781977503710486b-10" "
	"az1: "" "-2.42666075797738408996563340366561252666293298145559212717201b-14" "
	"az2: "" "1.44700939956622889720337614595069044140394861261730504570127b-14" "
	"az3: "" "-8.12484365131968117425236102956014340482325464009681109658444b-15" "
	"maxdifaz (''): "" "8.73597872871858272387628025319620509598655873324013165781922b-11" "
*/